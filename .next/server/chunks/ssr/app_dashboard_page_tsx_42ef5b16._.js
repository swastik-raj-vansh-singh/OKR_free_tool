module.exports=[20731,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(40695),f=a.i(3130),g=a.i(54161),h=a.i(2150),i=a.i(5522),j=a.i(17171),k=a.i(46893),l=a.i(65733),m=a.i(96221),n=a.i(50429),o=a.i(24669),p=a.i(53277),q=a.i(23025),r=a.i(41675),s=a.i(67900);let t=(0,a.i(70106).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var u=a.i(69520),v=a.i(16201),w=a.i(210);function x(){let a=(0,d.useRouter)(),[x,y]=(0,c.useState)(!0),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)("");(0,c.useEffect)(()=>{!async function(){try{let a=localStorage.getItem("userId");if(!a){C("Please log in to view your dashboard"),y(!1);return}let b=await fetch(`/api/okr/${a}`),c=await b.json();if(!b.ok||!c.success){C(c.error||"Failed to load your OKRs"),y(!1);return}let d={user:c.data.user,okr:{id:c.data.id,company_name:c.data.company_name,planning_period:c.data.planning_period,strategic_narrative:c.data.strategic_narrative,is_draft:c.data.is_draft,okrs:"string"==typeof c.data.okrs?JSON.parse(c.data.okrs):c.data.okrs}};A(d),y(!1)}catch(a){console.error("Error fetching dashboard data:",a),C("Failed to load dashboard. Please try again."),y(!1)}}()},[]);let L=a=>{let b=a.current_value??a.baseline_value,c=a.target_value;return 0===c?0:Math.min(Math.round(b/c*100),100)},M=a=>{let b=L(a);return b>=70?"on-track":b>=40?"at-risk":"off-track"},N=a=>a.key_results&&0!==a.key_results.length?Math.round(a.key_results.reduce((a,b)=>a+L(b),0)/a.key_results.length):0,O=async()=>{if(!F||!z)return;let a=[...z.okr.okrs];a[F.objectiveIndex].key_results[F.krIndex]={...F.kr,current_value:Number(H)},A({...z,okr:{...z.okr,okrs:a}}),E(!1)};if(x)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-accent/5",children:(0,b.jsx)(f.Card,{className:"w-full max-w-md border-border/50 bg-card/50 backdrop-blur",children:(0,b.jsx)(f.CardContent,{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)(m.Loader2,{className:"w-12 h-12 animate-spin text-primary mx-auto"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})]})})})});if(B||!z)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-background to-destructive/5",children:(0,b.jsx)(f.Card,{className:"w-full max-w-md border-destructive/50 bg-card/50 backdrop-blur",children:(0,b.jsx)(f.CardContent,{className:"py-12",children:(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("div",{className:"mx-auto p-3 rounded-full bg-destructive/10 w-fit",children:(0,b.jsx)(n.Target,{className:"w-12 h-12 text-destructive"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Unable to Load Dashboard"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:B||"Please check your invitation link."})]}),(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>{localStorage.removeItem("userId"),a.push("/")},children:[(0,b.jsx)(w.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Go Home"]})]})})})});let P=z?.okr.okrs&&0!==z.okr.okrs.length?Math.round(z.okr.okrs.reduce((a,b)=>a+N(b),0)/z.okr.okrs.length):0;return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-accent/5 py-8 px-4",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,b.jsxs)(f.Card,{className:"border-border/50 bg-card/50 backdrop-blur",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(f.CardTitle,{className:"text-3xl",children:"My OKR Dashboard"}),(0,b.jsxs)(f.CardDescription,{className:"text-base",children:["Track your objectives and key results for ",z.okr.planning_period]})]}),z.okr.is_draft&&(0,b.jsx)(g.Badge,{variant:"outline",className:"text-accent border-accent/30",children:"Draft"})]})}),(0,b.jsx)(f.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(0,b.jsx)(t,{className:"w-4 h-4 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Name"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:z.user.name})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(0,b.jsx)(n.Target,{className:"w-4 h-4 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Role"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:z.user.role})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(0,b.jsx)(s.Building2,{className:"w-4 h-4 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Company"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:z.okr.company_name})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(0,b.jsx)(r.Calendar,{className:"w-4 h-4 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Period"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:z.okr.planning_period})]})]})]})})]}),(0,b.jsxs)(f.Card,{className:"border-border/50 bg-card/50 backdrop-blur",children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{className:"text-lg",children:"Strategic Context"}),(0,b.jsx)(f.CardDescription,{children:"How your work contributes to the overall strategy"})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-line leading-relaxed",children:z.okr.strategic_narrative})})]}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-3",children:[(0,b.jsx)(f.Card,{className:"border-border/50 bg-card/50 backdrop-blur",children:(0,b.jsxs)(f.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Overall Progress"}),(0,b.jsxs)("p",{className:"text-3xl font-bold",children:[P,"%"]})]}),(0,b.jsx)("div",{className:"p-3 rounded-full bg-primary/10",children:(0,b.jsx)(o.TrendingUp,{className:"w-6 h-6 text-primary"})})]}),(0,b.jsx)(h.Progress,{value:P,className:"mt-4"})]})}),(0,b.jsx)(f.Card,{className:"border-border/50 bg-card/50 backdrop-blur",children:(0,b.jsxs)(f.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Objectives"}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:z.okr.okrs.length})]}),(0,b.jsx)("div",{className:"p-3 rounded-full bg-accent/10",children:(0,b.jsx)(n.Target,{className:"w-6 h-6 text-accent"})})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-4",children:[z.okr.okrs.reduce((a,b)=>a+b.key_results.length,0)," key results"]})]})}),(0,b.jsx)(f.Card,{className:"border-border/50 bg-card/50 backdrop-blur",children:(0,b.jsxs)(f.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"On Track"}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:z.okr.okrs.reduce((a,b)=>a+b.key_results.filter(a=>"on-track"===M(a)).length,0)})]}),(0,b.jsx)("div",{className:"p-3 rounded-full bg-accent/10",children:(0,b.jsx)(v.CheckCircle,{className:"w-6 h-6 text-accent"})})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-4",children:[z.okr.okrs.reduce((a,b)=>a+b.key_results.filter(a=>"on-track"!==M(a)).length,0)," ","need attention"]})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Your Objectives & Key Results"}),z.okr.okrs.map((a,c)=>(0,b.jsxs)(f.Card,{className:"border-border/50 bg-card/50 backdrop-blur",children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(g.Badge,{variant:"secondary",children:["O",c+1]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(f.CardTitle,{className:"text-lg",children:a.title}),a.description&&(0,b.jsx)(f.CardDescription,{className:"mt-1",children:a.description})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[N(a),"%"]}),(0,b.jsx)(h.Progress,{value:N(a),className:"w-24"})]})]})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:a.key_results.map((a,d)=>{let f=M(a),i=L(a),j=a.current_value??a.baseline_value;return(0,b.jsxs)("div",{className:"flex items-center gap-4 p-3 rounded-lg bg-background/50 border border-border/50",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground w-8",children:["KR",d+1]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm",children:a.title}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-1",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[j," / ",a.target_value," ",a.unit]}),(0,b.jsx)(h.Progress,{value:i,className:"w-32 h-1.5"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["on-track"===f&&(0,b.jsxs)(g.Badge,{variant:"outline",className:"text-accent border-accent/30 gap-1",children:[(0,b.jsx)(o.TrendingUp,{className:"w-3 h-3"}),"On track"]}),"at-risk"===f&&(0,b.jsxs)(g.Badge,{variant:"outline",className:"text-chart-4 border-chart-4/30 gap-1",children:[(0,b.jsx)(q.Minus,{className:"w-3 h-3"}),"At risk"]}),"off-track"===f&&(0,b.jsxs)(g.Badge,{variant:"outline",className:"text-destructive border-destructive/30 gap-1",children:[(0,b.jsx)(p.TrendingDown,{className:"w-3 h-3"}),"Off track"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>{G({objectiveIndex:c,krIndex:d,kr:a}),I(String(a.current_value??a.baseline_value)),K(""),E(!0)},children:[(0,b.jsx)(u.RefreshCw,{className:"w-3 h-3 mr-1"}),"Update"]})]})]},d)})})})]},c))]}),(0,b.jsx)(l.Dialog,{open:D,onOpenChange:E,children:(0,b.jsxs)(l.DialogContent,{children:[(0,b.jsxs)(l.DialogHeader,{children:[(0,b.jsx)(l.DialogTitle,{children:"Update Progress"}),(0,b.jsx)(l.DialogDescription,{children:F?.kr.title})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Current Value"}),(0,b.jsx)(i.Input,{type:"number",placeholder:"Enter current value",value:H,onChange:a=>I(a.target.value)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Target: ",F?.kr.target_value," ",F?.kr.unit]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Notes (optional)"}),(0,b.jsx)(k.Textarea,{placeholder:"What progress was made?",value:J,onChange:a=>K(a.target.value),rows:3})]})]}),(0,b.jsxs)(l.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:O,disabled:!H,children:"Save Update"})]})]})})]})})}a.s(["default",()=>x],20731)}];

//# sourceMappingURL=app_dashboard_page_tsx_42ef5b16._.js.map