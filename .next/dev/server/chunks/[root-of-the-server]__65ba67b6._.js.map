{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/swastikrajvanshsingh/Downloads/ai-tools-for-traffic/app/api/user/reminder-settings/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(req: NextRequest) {\n  try {\n    console.log('[REMINDER_SETTINGS] API called');\n\n    const body = await req.json();\n    console.log('[REMINDER_SETTINGS] Request body:', body);\n\n    const { user_id, reminder_enabled, reminder_frequency, reminder_day, reminder_time } = body;\n\n    // Validate required fields\n    if (!user_id) {\n      console.error('[REMINDER_SETTINGS] user_id is missing');\n      return NextResponse.json({ error: 'user_id is required' }, { status: 400 });\n    }\n\n    // Get database URL from environment\n    const databaseUrl = process.env.DATABASE_URL;\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n    const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n    console.log('[REMINDER_SETTINGS] Environment check:', {\n      hasDatabaseUrl: !!databaseUrl,\n      hasSupabaseUrl: !!supabaseUrl,\n      hasSupabaseKey: !!supabaseAnonKey,\n    });\n\n    if (!supabaseUrl || !supabaseAnonKey) {\n      console.error('[REMINDER_SETTINGS] Supabase credentials not configured');\n      return NextResponse.json({ error: 'Server configuration error: Missing Supabase credentials' }, { status: 500 });\n    }\n\n    // Import postgres client dynamically to avoid bundling issues\n    const { createClient } = await import('@supabase/supabase-js');\n    const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n    // Update user reminder settings\n    // Note: Using 'id' column instead of 'user_id' based on Supabase schema\n    const { data, error } = await supabase\n      .from('users')\n      .update({\n        reminder_enabled: reminder_enabled ?? true,\n        reminder_frequency: reminder_frequency ?? 'weekly',\n        reminder_day: reminder_day ?? 'monday',\n        reminder_time: reminder_time ?? '18:00:00',\n      })\n      .eq('id', user_id)\n      .select();\n\n    if (error) {\n      console.error('[REMINDER_SETTINGS] Database error:', JSON.stringify(error, null, 2));\n      return NextResponse.json({\n        error: 'Failed to update reminder settings',\n        details: error.message,\n        hint: error.hint,\n        code: error.code\n      }, { status: 500 });\n    }\n\n    console.log('[REMINDER_SETTINGS] Successfully updated for user:', user_id);\n    console.log('[REMINDER_SETTINGS] Updated data:', data);\n\n    return NextResponse.json({\n      success: true,\n      message: 'Reminder settings updated successfully',\n      data: data?.[0] || null,\n    });\n\n  } catch (error) {\n    console.error('[REMINDER_SETTINGS] Error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: error instanceof Error ? error.message : 'Failed to update reminder settings',\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,GAAG,CAAC,qCAAqC;QAEjD,MAAM,EAAE,OAAO,EAAE,gBAAgB,EAAE,kBAAkB,EAAE,YAAY,EAAE,aAAa,EAAE,GAAG;QAEvF,2BAA2B;QAC3B,IAAI,CAAC,SAAS;YACZ,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,oCAAoC;QACpC,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;QAC5C,MAAM;QACN,MAAM;QAEN,QAAQ,GAAG,CAAC,0CAA0C;YACpD,gBAAgB,CAAC,CAAC;YAClB,gBAAgB,CAAC,CAAC;YAClB,gBAAgB,CAAC,CAAC;QACpB;QAEA;;QAKA,8DAA8D;QAC9D,MAAM,EAAE,YAAY,EAAE,GAAG;QACzB,MAAM,WAAW,aAAa,aAAa;QAE3C,gCAAgC;QAChC,wEAAwE;QACxE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,SACL,MAAM,CAAC;YACN,kBAAkB,oBAAoB;YACtC,oBAAoB,sBAAsB;YAC1C,cAAc,gBAAgB;YAC9B,eAAe,iBAAiB;QAClC,GACC,EAAE,CAAC,MAAM,SACT,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,uCAAuC,KAAK,SAAS,CAAC,OAAO,MAAM;YACjF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,OAAO;gBACP,SAAS,MAAM,OAAO;gBACtB,MAAM,MAAM,IAAI;gBAChB,MAAM,MAAM,IAAI;YAClB,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,QAAQ,GAAG,CAAC,sDAAsD;QAClE,QAAQ,GAAG,CAAC,qCAAqC;QAEjD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,MAAM,MAAM,CAAC,EAAE,IAAI;QACrB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}