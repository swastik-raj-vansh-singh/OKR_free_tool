{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/swastikrajvanshsingh/Downloads/ai-tools-for-traffic/lib/supabase.ts"],"sourcesContent":["/**\n * Supabase Client Configuration\n * Provides database access for OKR application\n */\n\nimport { createClient } from '@supabase/supabase-js'\nimport type { InvitationData } from './types'\n\n// Initialize Supabase client\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\n\n// ============================================================================\n// Invitation Helper Functions\n// ============================================================================\n\n/**\n * Validate invitation token and fetch invitation data\n */\nexport async function validateInvitationToken(token: string): Promise<InvitationData | null> {\n  try {\n    // Fetch user by invitation token\n    const { data: user, error: userError } = await supabase\n      .from('users')\n      .select('*')\n      .eq('invitation_token', token)\n      .single()\n\n    if (userError || !user) {\n      console.error('User not found for token:', token)\n      return null\n    }\n\n    // Check if invitation is already accepted\n    if (user.invitation_accepted_at) {\n      return null\n    }\n\n    // Fetch user's OKRs\n    const { data: okr, error: okrError } = await supabase\n      .from('okr_generations')\n      .select('*')\n      .eq('user_id', user.id)\n      .eq('is_draft', true)\n      .single()\n\n    if (okrError || !okr) {\n      console.error('OKR not found for user:', user.id)\n      return null\n    }\n\n    // Fetch leader info (optional)\n    let leader = null\n    if (user.invited_by) {\n      const { data: leaderData, error: leaderError } = await supabase\n        .from('users')\n        .select('name, email')\n        .eq('id', user.invited_by)\n        .single()\n\n      if (!leaderError && leaderData) {\n        leader = leaderData\n      }\n    }\n\n    return {\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.name,\n        role: user.role,\n        invitation_token: user.invitation_token,\n        invitation_sent_at: user.invitation_sent_at,\n        invitation_accepted_at: user.invitation_accepted_at,\n      },\n      okr: {\n        id: okr.id,\n        user_id: okr.user_id,\n        website_url: okr.website_url,\n        company_name: okr.company_name,\n        planning_period: okr.planning_period,\n        strategic_narrative: okr.strategic_narrative,\n        okrs: okr.okrs,\n        is_draft: okr.is_draft,\n        created_at: okr.created_at,\n      },\n      leader,\n    }\n  } catch (error) {\n    console.error('Error validating invitation token:', error)\n    return null\n  }\n}\n\n/**\n * Accept invitation and finalize OKRs\n */\nexport async function acceptInvitation(token: string): Promise<{ success: boolean; message: string }> {\n  try {\n    // Get user by token\n    const { data: user, error: userError } = await supabase\n      .from('users')\n      .select('id')\n      .eq('invitation_token', token)\n      .single()\n\n    if (userError || !user) {\n      return { success: false, message: 'Invalid invitation token' }\n    }\n\n    // Check if already accepted\n    const { data: existingUser } = await supabase\n      .from('users')\n      .select('invitation_accepted_at')\n      .eq('id', user.id)\n      .single()\n\n    if (existingUser?.invitation_accepted_at) {\n      return { success: false, message: 'Invitation already accepted' }\n    }\n\n    // Update user: mark invitation as accepted\n    const { error: updateUserError } = await supabase\n      .from('users')\n      .update({ invitation_accepted_at: new Date().toISOString() })\n      .eq('id', user.id)\n\n    if (updateUserError) {\n      console.error('Error updating user:', updateUserError)\n      return { success: false, message: 'Failed to accept invitation' }\n    }\n\n    // Update OKR: mark as finalized (not draft)\n    const { error: updateOkrError } = await supabase\n      .from('okr_generations')\n      .update({ is_draft: false })\n      .eq('user_id', user.id)\n\n    if (updateOkrError) {\n      console.error('Error updating OKR:', updateOkrError)\n      return { success: false, message: 'Failed to finalize OKRs' }\n    }\n\n    return { success: true, message: 'Invitation accepted successfully' }\n  } catch (error) {\n    console.error('Error accepting invitation:', error)\n    return { success: false, message: 'An error occurred while accepting the invitation' }\n  }\n}\n\n/**\n * Update OKRs for a user (before accepting)\n */\nexport async function updateDraftOKRs(userId: string, okrs: any): Promise<{ success: boolean; message: string }> {\n  try {\n    const { error } = await supabase\n      .from('okr_generations')\n      .update({ okrs })\n      .eq('user_id', userId)\n      .eq('is_draft', true)\n\n    if (error) {\n      console.error('Error updating OKRs:', error)\n      return { success: false, message: 'Failed to update OKRs' }\n    }\n\n    return { success: true, message: 'OKRs updated successfully' }\n  } catch (error) {\n    console.error('Error in updateDraftOKRs:', error)\n    return { success: false, message: 'An error occurred while updating OKRs' }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///Users/swastikrajvanshsingh/Downloads/ai-tools-for-traffic/app/api/okr/%5BuserId%5D/route.ts"],"sourcesContent":["/**\n * API Route: GET /api/okr/[userId]\n * Fetches OKR data for a specific user\n */\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport { supabase } from '@/lib/supabase'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ userId: string }> }\n) {\n  try {\n    const { userId } = await params\n\n    if (!userId) {\n      return NextResponse.json(\n        { error: 'User ID is required' },\n        { status: 400 }\n      )\n    }\n\n    // Fetch user info first\n    const { data: user, error: userError } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', userId)\n      .single()\n\n    if (userError || !user) {\n      console.error('User not found:', userId, userError)\n      return NextResponse.json(\n        { error: 'User not found' },\n        { status: 404 }\n      )\n    }\n\n    // Fetch user's OKRs (fetch both draft and finalized)\n    const { data: okr, error: okrError } = await supabase\n      .from('okr_generations')\n      .select('*')\n      .eq('user_id', userId)\n      .order('created_at', { ascending: false })\n      .limit(1)\n      .single()\n\n    if (okrError || !okr) {\n      console.error('OKR not found for user:', userId, okrError)\n      return NextResponse.json(\n        { error: 'OKR not found for user' },\n        { status: 404 }\n      )\n    }\n\n    // Return OKR data with user info\n    return NextResponse.json({\n      success: true,\n      data: {\n        user: {\n          id: user.id,\n          name: user.name,\n          email: user.email,\n          role: user.role,\n        },\n        id: okr.id,\n        user_id: okr.user_id,\n        website_url: okr.website_url,\n        company_name: okr.company_name,\n        planning_period: okr.planning_period,\n        strategic_narrative: okr.strategic_narrative,\n        okrs: okr.okrs,\n        is_draft: okr.is_draft,\n        created_at: okr.created_at,\n      },\n    })\n  } catch (error) {\n    console.error('Error in GET /api/okr/[userId]:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AAED;AACA;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAA2C;IAEnD,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM;QAEzB,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,wBAAwB;QACxB,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,6HAAQ,CACpD,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QACT,MAAM;QAET,IAAI,aAAa,CAAC,MAAM;YACtB,QAAQ,KAAK,CAAC,mBAAmB,QAAQ;YACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,qDAAqD;QACrD,MAAM,EAAE,MAAM,GAAG,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,6HAAQ,CAClD,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,QACd,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,GACN,MAAM;QAET,IAAI,YAAY,CAAC,KAAK;YACpB,QAAQ,KAAK,CAAC,2BAA2B,QAAQ;YACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iCAAiC;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,MAAM;oBACJ,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;gBACjB;gBACA,IAAI,IAAI,EAAE;gBACV,SAAS,IAAI,OAAO;gBACpB,aAAa,IAAI,WAAW;gBAC5B,cAAc,IAAI,YAAY;gBAC9B,iBAAiB,IAAI,eAAe;gBACpC,qBAAqB,IAAI,mBAAmB;gBAC5C,MAAM,IAAI,IAAI;gBACd,UAAU,IAAI,QAAQ;gBACtB,YAAY,IAAI,UAAU;YAC5B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}